<!-- Author: Nguyễn Viết Hoàng Phúc 22/11/1997 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký tài khoản</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header text-center">
                    <h2>Đăng ký tài khoản</h2>
                </div>
                <div class="card-body">
                    <form th:object="${user}" id="registerForm" method="post" th:action="@{/save}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" th:field="*{email}" class="form-control" id="email" placeholder="Nhập email" required>
                            <!-- Hiển thị lỗi từ validation -->
                            <div style="color: red;" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Email error</div>
                            <!-- Hiển thị lỗi nếu email đã tồn tại -->
                            <div style="color: red;" th:if="${emailError != null}" th:text="${emailError}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" th:field="*{password}" class="form-control" id="password" placeholder="Nhập password" required>
                            <div style="color: red;" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="rePassword" class="form-label">Nhập lại password</label>
                            <input type="password"  class="form-control" id="rePassword" placeholder="Nhập lại password" required>
                            <div style="color: red;" id="re-password"></div>
                        </div>

                        <div class="mb-3">
                            <label for="userName" class="form-label">Tên người dùng</label>
                            <input type="text" th:field="*{userName}" class="form-control" id="userName" placeholder="Nhập tên người dùng" required>
                            <div style="color: red;" th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label">Số điện thoại</label>
                            <input type="number" th:field="*{phone}" class="form-control" id="phoneNumber" placeholder="Nhập số điện thoại" required>
                            <div style="color: red;" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="address" class="form-label">Địa chỉ</label>
                            <input type="text" th:field="*{address}" class="form-control" id="address" placeholder="Nhập địa chỉ" required>
                            <div style="color: red;" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Đăng ký</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
 $('#registerForm').on('submit', function (e) {
     let isValid = true;

     //validate mail
     const email = $('#email').val();
     const emailPartern = /^[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;
     if (!emailPartern.test(email)) {
         $('#emailError').text('Email không hợp lệ!');
         isValid = false;
     }
     else {
         $('#emailError').text('');
     }
     //Validate password
     const password = $('#password').val();
     const upperCaseRegex = /[A-Z]/;  // Biểu thức chính quy kiểm tra ký tự viết hoa

     if (password.length < 8) {
         $('#passwordError').text('Password phải có ít nhất 8 ký tự.');
         isValid = false;
     } else if (!upperCaseRegex.test(password)) {
         $('#passwordError').text('Password phải có ít nhất 1 ký tự viết hoa.');
         isValid = false;
     } else {
         $('#passwordError').text('');
     }
     // Validate confirm password
     const rePassword = $('#rePassword').val();
     if (password !== rePassword) {
         $('#rePasswordError').text('Password nhập lại không khớp.');
         isValid = false;
     } else {
         $('#rePasswordError').text('');
     }
     // Validate phone number
     const phone = $('#phoneNumber').val();
     const phonePattern = /^\d{10}$/;
     if (!phonePattern.test(phone)) {
         $('#phoneNumberError').text('Số điện thoại phải có 10 số.');
         isValid = false;
     } else {
         $('#phoneNumberError').text('');
     }
     // Nếu có lỗi, ngăn form submit
     if (!isValid) {
         e.preventDefault();
     }
 })
 })
</script>
</body>
</html>
