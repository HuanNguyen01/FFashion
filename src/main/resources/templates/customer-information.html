
<!-- @author Duong Van Luc 01/07/2000 -->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thông tin khách hàng</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/navigation.css">
<style>
body, html {
	height: 92%;
	margin: 0;
	font-family: Arial, sans-serif;
	background-color: #F0F0F0;
}

.wrapper {
	display: flex;
	height: 100%;
}

/* Sidebar styles */
.sidebar {
	width: 250px;
	height: 100%;
	background-color: white;
	color: #000000;
	display: flex;
	flex-direction: column;
	padding-top: 20px;
}

.sidebar a {
	color: #000000;
	text-decoration: none;
	padding: 15px;
	display: block;
	font-size: 18px;
}

.sidebar a:hover {
	background-color: #F0F0F0;
}

/* Content styles */
.content {
	flex-grow: 1;
	padding: 20px;
	overflow-y: auto;
}

.form-group .btn {
	width: 40px;
	height: 40px;
}
</style>
</head>

<body>

	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-light">
		<div class="container-fluid">
			<!-- Logo và Tên Shop -->
			<a class="navbar-brand d-flex align-items-center" href="#"> <img
				src="https://scontent.fhan14-2.fna.fbcdn.net/v/t1.6435-9/111347945_149761543443087_5072562482487010106_n.png?_nc_cat=108&ccb=1-7&_nc_sid=127cfc&_nc_ohc=8ZvgBmWDyEoQ7kNvgHa3jNb&_nc_ht=scontent.fhan14-2.fna&_nc_gid=A6xdGRhrwMtPnWPksQczALV&oh=00_AYDXjNbsaR1cHwD4Qo5pZ3CgQP4Un25AasKSKWt7lzRTUg&oe=6705D921"
				alt="Logo" width="40" height="40" class="mr-2"> <span>F
					FASHION</span>
			</a>

			<!-- Mega Menu -->
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item"><a class="nav-link" href="#">Sản phẩm
							mới</a></li>
					<li class="nav-item"><a class="nav-link" href="#">Sale</a></li>
					<!-- Mega Menu Áo -->
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false"> Áo </a>
						<div class="dropdown-menu mega-menu"
							aria-labelledby="navbarDropdown">
							<div class="row">
								<!-- Cấp 2: Áo khoác -->
								<div class="col-md-4">
									<h6>Áo khoác</h6>
									<!-- Cấp 3: Áo bomber, hoodie, phao -->
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Bomber</a></li>
										<li><a class="dropdown-item" href="#">Hoodie</a></li>
										<li><a class="dropdown-item" href="#">Áo phao</a></li>
									</ul>
								</div>
								<!-- Cấp 2: Áo thun -->
								<div class="col-md-4">
									<h6>Áo thun</h6>
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Áo thun cổ tròn</a></li>
										<li><a class="dropdown-item" href="#">Áo thun cổ tim</a></li>
										<li><a class="dropdown-item" href="#">Áo thun thể
												thao</a></li>
										<li><a class="dropdown-item" href="#">Áo thun polo</a></li>

									</ul>
								</div>
								<!-- Cấp 2: Áo sơ mi -->
								<div class="col-md-4">
									<h6>Áo sơ mi</h6>
									<!-- Cấp 3: Các loại áo sơ mi -->
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Áo sơ mi trắng</a></li>
										<li><a class="dropdown-item" href="#">Áo sơ mi kẻ sọc</a></li>
										<li><a class="dropdown-item" href="#">Áo sơ mi tay
												ngắn</a></li>
										<li><a class="dropdown-item" href="#">Áo sơ mi caro</a></li>
									</ul>
								</div>
							</div>
						</div></li>

					<!-- Mega Menu Quần -->
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false"> Quần </a>
						<div class="dropdown-menu mega-menu"
							aria-labelledby="navbarDropdown">
							<div class="row">
								<!-- Cấp 2: Quần short -->
								<div class="col-md-4">
									<h6>Quần short</h6>
									<!-- Cấp 3: Quần short kaki, thun, nỉ -->
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Quần short kaki</a></li>
										<li><a class="dropdown-item" href="#">Quần short thun</a></li>
										<li><a class="dropdown-item" href="#">Quần short nỉ</a></li>
									</ul>
								</div>
								<!-- Cấp 2: Quần jean -->
								<div class="col-md-4">
									<h6>Quần jean</h6>
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Quần jean
												slimfit</a></li>
										<li><a class="dropdown-item" href="#">Quần jean
												regular</a></li>
										<li><a class="dropdown-item" href="#">Quần jean
												skinny</a></li>
										<li><a class="dropdown-item" href="#">Quần jean bass</a></li>

									</ul>
								</div>
								<!-- Cấp 2: Quần sịp -->
								<div class="col-md-4">
									<h6>Quần sịp</h6>
									<!-- Cấp 3: Các loại quần sịp -->
									<ul class="list-unstyled">
										<li><a class="dropdown-item" href="#">Quần sịp boxer</a></li>
										<li><a class="dropdown-item" href="#">Quần sịp tam
												giác</a></li>
										<li><a class="dropdown-item" href="#">Quần sịp lọt
												khe</a></li>
									</ul>
								</div>
							</div>
						</div></li>

					<li class="nav-item"><a class="nav-link" href="#">Tin tức</a>
					</li>
				</ul>
			</div>


			<!-- Icon giỏ hàng, thanh tìm kiếm và thông tin tài khoản -->
			<div
				class="navbar-icons d-flex align-items-center ml-auto justify-content-end">

				<!-- Phần thanh tìm kiếm -->
				<form class="form-inline my-2 my-lg-0 search-bar">
					<input class="form-control mr-sm-2" type="search"
						placeholder="Tìm kiếm" aria-label="Search">
				</form>


				<!-- Icon giỏ hàng -->
				<a href="#" class="nav-link"> <i class="fas fa-shopping-cart"></i>
				</a>

				<!-- Thông tin tài khoản -->
				<div class="account-info d-flex align-items-center">
					<div class="login-box">
						<a href="#" class="nav-link">Đăng nhập</a>
					</div>
					<div class="register-box">
						<a href="#" class="nav-link">Đăng ký</a>
					</div>
				</div>

				<!-- Nút toggle khi trên mobile -->
				<button class="navbar-toggler" type="button" data-toggle="collapse"
					data-target="#navbarNav" aria-controls="navbarNav"
					aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
			</div>
		</div>
	</nav>

	<div class="wrapper mt-5">
		<!-- Sidebar -->
		<div class="sidebar mr-3 ml-5">
			<h5
				class="text-center font-weight-bold border-bottom pb-2 custom-border ml-2 mr-2 mb-0">TÀI
				KHOẢN</h5>
			<a href="/information"
				class="d-block border-bottom py-2 ml-2 mr-2 pb-3 pt-3"><i
				class="fas fa-user mr-2"></i> Thông tin người dùng</a> <a
				href="/information/purchase-history"
				class="d-block border-bottom py-2 ml-2 mr-2 pb-3 pt-3"><i
				class="fas fa-history mr-2"></i> Lịch sử giao dịch</a>
		</div>

		<!-- Content -->
		<div class="content mr-5" style="background-color: white;">
			<div class="container">
				<h5 class="text-center font-weight-bold">THÔNG TIN NGƯỜI DÙNG</h5>
				<form id="customerForm" method="post"
					th:action="@{/information/update-info}">
					<!-- Trường Email -->
					<div class="form-group row">
						<label for="email" class="col-sm-2 col-form-label">Email:</label>
						<div class="col-sm-7">
							<input type="email" class="form-control" id="email" name="email"
								th:value="${user.email}" readonly>
						</div>
					</div>

					<!-- Trường Mật khẩu -->
					<div class="form-group row">
						<label for="password" class="col-sm-2 col-form-label">Mật
							khẩu:</label>
						<div class="col-sm-7">
							<input type="password" class="form-control" id="password"
								name="password" value="••••••••••" readonly>
						</div>
						<div class="col-sm-3">
							<button type="button" class="btn btn-outline-info btn-edit"
								data-field="password">
								<i class="fas fa-edit"></i>
							</button>
						</div>
					</div>
					<!-- Trường Tên -->
					<div class="form-group row">
						<label for="name" class="col-sm-2 col-form-label">Tên
							người dùng:</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" id="name" name="name"
								th:value="${user.userName}" readonly>
						</div>
						<div class="col-sm-3">
							<button type="button" class="btn btn-outline-info btn-edit"
								data-field="name">
								<i class="fas fa-edit"></i>
							</button>
						</div>
					</div>

					<!-- Trường Số điện thoại -->
					<div class="form-group row">
						<label for="phone" class="col-sm-2 col-form-label">Số điện
							thoại:</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" id="phone" name="phone"
								th:value="${user.phone}" readonly>
						</div>
						<div class="col-sm-3">
							<button type="button" class="btn btn-outline-info btn-edit"
								data-field="phone">
								<i class="fas fa-edit"></i>
							</button>
						</div>
					</div>

					<!-- Trường Địa chỉ -->
					<div class="form-group row">
						<label for="address" class="col-sm-2 col-form-label">Địa
							chỉ:</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" id="address"
								name="address" th:value="${user.address}" readonly>
						</div>
						<div class="col-sm-3">
							<button type="button" class="btn btn-outline-info btn-edit"
								data-field="address">
								<i class="fas fa-edit"></i>
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>

	</div>

	<!-- Modal for changing password -->
	<div class="modal fade" id="passwordModal" tabindex="-1" role="dialog"
		aria-labelledby="passwordModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title font-weight-bold" id="passwordModalLabel">Đổi
						mật khẩu</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="passwordChangeForm"
						th:action="@{/information/change-password}" method="post">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />

						<!-- Các trường nhập liệu -->
						<div class="form-group">
							<label for="oldPassword">Mật khẩu cũ: <span
								class="text-danger">*</span></label> <input type="password"
								class="form-control" id="oldPassword" name="oldPassword"
								required>
						</div>
						<div class="form-group">
							<label for="newPassword">Mật khẩu mới: <span
								class="text-danger">*</span></label> <input type="password"
								class="form-control" id="newPassword" name="newPassword"
								required>
						</div>
						<div class="form-group">
							<label for="confirmNewPassword">Nhập lại mật khẩu mới: <span
								class="text-danger">*</span></label> <input type="password"
								class="form-control" id="confirmNewPassword"
								name="confirmNewPassword" required>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">Hủy</button>
					<button type="button" class="btn btn-primary" id="savePassword">Lưu
						mật khẩu</button>
				</div>
			</div>
		</div>
	</div>

	<footer class="footer pt-5">
		<div class="container">
			<div class="row">
				<!-- Cột 1: Thông tin shop và mạng xã hội -->
				<div class="col-lg-4 col-md-6 mb-4">
					<h5 class="font-weight-bold">Thời trang nam F Fashion</h5>
					<p>Hệ thống thời trang cho phái mạnh hàng đầu Việt Nam, hướng
						tới phong cách nam tính, lịch lãm và trẻ trung.</p>
					<div class="social-icons">
						<a href="#"><i class="fab fa-facebook-f"></i></a> <a href="#"><i
							class="fab fa-twitter"></i></a> <a href="#"><i
							class="fab fa-instagram"></i></a> <a href="#"><i
							class="fab fa-tiktok"></i></a> <a href="#"><i
							class="fab fa-youtube"></i></a>
					</div>
				</div>

				<!-- Cột 2: Thông tin liên hệ và vận chuyển -->
				<div class="col-lg-4 col-md-6 mb-4">
					<h5 class="font-weight-bold">Thông tin liên hệ</h5>
					<p>
						<strong>Địa chỉ:</strong> Tầng 5, tòa nhà Manor Crown, số 32 Tố
						Hữu, Xuân Phú, Huế
					</p>
					<p>
						<strong>Điện thoại:</strong> 0905686868
					</p>
					<p>
						<strong>Email:</strong> cskh@ffashion.vn
					</p>
				</div>

				<!-- Cột 3: Nhóm liên kết -->
				<div class="col-lg-4 col-md-6 mb-4">
					<h5 class="font-weight-bold">Dịch vụ khách hàng</h5>
					<ul class="list-unstyled">
						<li><a href="#">Giới thiệu</a></li>
						<li><a href="#">Chính sách đổi trả</a></li>
						<li><a href="#">Liên hệ</a></li>
					</ul>
				</div>

			</div>
		</div>
	</footer>
	<div class="footer-copyright text-center py-3">
		<p class="mb-0">© 2024 F Fashion. Powered by Mock Team 2</p>
	</div>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// Khi nhấn nút Edit, hiện modal để đổi mật khẩu hoặc bật chỉnh sửa các trường khác
		// Sự kiện cho các nút "Edit" của các trường thông tin
		$('.btn-edit')
				.on(
						'click',
						function() {
							var field = $(this).data('field');
							var button = $(this);
							var input = $('#' + field);

							// Nếu nhấn vào nút chỉnh sửa của các trường thông tin (không phải mật khẩu)
							if (field !== 'password') {
								// Nếu đang ở chế độ chỉ đọc, chuyển sang chỉnh sửa
								if (input.prop('readonly')
										|| input.prop('disabled')) {
									input.prop('readonly', false);
									input.prop('disabled', false);
									button.html('<i class="fas fa-save"></i>'); // Đổi nút thành Save
									button.removeClass('btn-outline-info')
											.addClass('btn-success'); // Đổi màu thành xanh
								}
								// Nếu đang ở chế độ chỉnh sửa, lưu dữ liệu
								else {
									var updatedValue = input.val(); // Lấy giá trị mới từ input

									// Lấy CSRF token và header từ meta tags
									var csrfToken = $('meta[name="_csrf"]')
											.attr('content');
									var csrfHeader = $(
											'meta[name="_csrf_header"]').attr(
											'content');

									// Gửi dữ liệu cập nhật qua AJAX
									$
											.ajax({
												type : "POST",
												url : "/information/update-info", // Endpoint xử lý cập nhật thông tin người dùng
												data : {
													field : field, // Trường thông tin cần cập nhật
													value : updatedValue
												// Giá trị mới
												},
												beforeSend : function(xhr) {
													// Thêm CSRF token vào header của yêu cầu
													xhr.setRequestHeader(
															csrfHeader,
															csrfToken);
												},
												success : function(response) {
													alert('Cập nhật thành công!'); // Hiển thị thông báo thành công
													input
															.prop('readonly',
																	true); // Chuyển về chế độ chỉ đọc
													input
															.prop('disabled',
																	true);
													button
															.html('<i class="fas fa-edit"></i>'); // Đổi lại nút thành Edit
													button
															.removeClass(
																	'btn-success')
															.addClass(
																	'btn-outline-info');
												},
												error : function(xhr, status,
														error) {
													alert('Có lỗi xảy ra khi cập nhật: '
															+ error);
												}
											});
								}
							}
							// Nếu là trường mật khẩu, hiển thị modal để đổi mật khẩu
							else {
								$('#passwordModal').modal('show');
							}
						});

		// Xử lý sự kiện lưu mật khẩu trong modal
		$('#savePassword')
				.on(
						'click',
						function(event) {
							event.preventDefault(); // Ngăn không cho form submit ngay lập tức

							var oldPassword = $('#oldPassword').val();
							var newPassword = $('#newPassword').val();
							var confirmNewPassword = $('#confirmNewPassword')
									.val();

							if (newPassword !== confirmNewPassword) {
								alert('Mật khẩu mới không khớp!');
								return;
							}

							// Lấy CSRF token và header từ meta tags
							var csrfToken = $('meta[name="_csrf"]').attr(
									'content');
							var csrfHeader = $('meta[name="_csrf_header"]')
									.attr('content');

							// Gửi yêu cầu AJAX để thay đổi mật khẩu
							$
									.ajax({
										type : "POST",
										url : "/information/change-password", // Đúng đường dẫn của controller cho đổi mật khẩu
										data : {
											oldPassword : oldPassword,
											newPassword : newPassword,
											confirmNewPassword : confirmNewPassword
										},
										beforeSend : function(xhr) {
											// Đặt header CSRF token
											xhr.setRequestHeader(csrfHeader,
													csrfToken);
										},
										success : function(response) {
											if (response === 'Mật khẩu cũ không đúng!') {
												alert('Mật khẩu cũ không đúng!');
											} else if (response === 'Mật khẩu mới không khớp!') {
												alert('Mật khẩu mới không khớp!');
											} else if (response === 'Mật khẩu đã được thay đổi thành công!') {
												alert('Mật khẩu đã được thay đổi thành công!');
												$('#passwordModal').modal(
														'hide'); // Ẩn modal khi thành công
											}
										},
										error : function(xhr, status, error) {
											alert('Có lỗi xảy ra: '
													+ xhr.responseText);
										}
									});
						});
	</script>
</body>

</html>